---
title: 'ì¿ í‚¤ì°¨ë‹¨ ì„¤ì • ì‹œ ë°œìƒí•˜ëŠ” ë¬¸ì œ í•´ê²°í•˜ê¸°'
date: '2024-10-08'
description: 'ì¿ í‚¤ì°¨ë‹¨ ì„¤ì • ì‹œ ë°œìƒí•˜ëŠ” ë¬¸ì œ í•´ê²°í•˜ê¸°'
tags: ['storage', 'troubleshooting', 'íŠ¸ëŸ¬ë¸”ìŠˆíŒ…']
---

## â—ï¸ìš”êµ¬ì‚¬í•­

![](https://velog.velcdn.com/images/sa02045/post/a71b7d79-317e-4147-a42f-5242efe91056/image.png)

ì¿ í‚¤ ì°¨ë‹¨ì„ í•˜ë©´ í™ˆí˜ì´ì§€ê°€ ì •ìƒì‘ë™í•˜ì§€ ì•ŠëŠ”ë‹¤ëŠ” íŒ€ë‚´ ìŠ¤ë ˆë“œê°€ ì˜¬ë¼ì™”ë‹¤. ì‹¤ì œë¡œ ì§ì ‘ ì¬í˜„ì„ í•´ë³´ë‹ˆ ì•„ë¬´ê²ƒë„ ë³´ì´ì§€ ì•Šê³  í•˜ì–€í™”ë©´ë§Œ ë‚˜ì™”ë”°

ì†ì´ ëœì»¹ ë‚´ë ¤ì•‰ì•˜ì§€ë§Œ ì°¨ë¶„íˆ ë§ˆìŒì„ ê°€ë¼ì•‰íˆê³  ìš°ì„  ì°¨ê·¼ì°¨ê·¼ ì›ì¸ì„ íŒŒì•…í•´ë³´ì•˜ë‹¤.

## âœ‹ ì›ì¸ íŒŒì•… ë° ë¬¸ì œ ë¶„ì„

ìš°ì„ ì€ ë¸Œë¼ìš°ì €ë¥¼ ì—´ì–´ ì—ëŸ¬ ì½˜ì†”ì„ í™•ì¸í•´ë³´ì•˜ë‹¤. window í”„ëŸ¬í¼í‹°ì˜ localStorage ì ‘ê·¼ë¬¸ì œì¸ ê²ƒìœ¼ë¡œ ë³´ì˜€ë‹¤.

![](https://velog.velcdn.com/images/sa02045/post/3ec74bc1-9dfb-4de1-900d-a54ab6ca44f8/image.png)

LocalStorageê°€ ë¸Œë¼ìš°ì €ì—ì„œ ì •ìƒ ì‘ë™í•˜ì§€ ì•ŠëŠ” ê²½ìš°ëŠ” ì—¬ëŸ¬ ì´ìœ ê°€ ìˆë‹¤.

- `ì„œë²„ì‚¬ì´ë“œ ë Œë”ë§`ì—ì„œ window.localStorageë¥¼ ì°¸ì¡°í•˜ëŠ” ê²½ìš°
- ë¸Œë¼ìš°ì €ê°€ Storage APIë¥¼ ì§€ì›í•˜ì§€ ì•ŠëŠ” ê²½ìš° (í˜¸í™˜ì„±)
- ë¸Œë¼ìš°ì €ê°€ Storageì— ëŒ€í•œ ì ‘ê·¼ì„ ì°¨ë‹¨í•˜ëŠ” ê²½ìš° (ë³´ì•ˆ)

ì´ë²ˆ ì´ìŠˆëŠ” ì„¸ ë²ˆì§¸ ê²½ìš°ë¡œ `ìœ ì €ê°€ ë¸Œë¼ìš°ì € ì„¤ì •ì—ì„œ ì¿ í‚¤ ì°¨ë‹¨`ì„ ì„¤ì •í–ˆì„ ë•Œ ì¼ì–´ë‚œ ê²ƒì´ë‹¤.

![](https://velog.velcdn.com/images/sa02045/post/071f8612-0a93-4b27-a3de-87161696e1c4/image.png)

> ì¿ í‚¤ì°¨ë‹¨ ì„¤ì •ì„ í•˜ë©´ ìœ ì €ì˜ ê°œì¸ì •ë³´ë³´í˜¸ë¥¼ ìœ„í•´ ì¿ í‚¤ë‚˜ localStorageì™€ ê°™ì´ ë¸Œë¼ìš°ì €ì— ë°ì´í„°ë¥¼ ì½ê³  ì €ì¥í•˜ëŠ” ê¸°ëŠ¥ì„ ì°¨ë‹¨ì‹œí‚¨ë‹¤.

ë‚´ë¶€ ì½”ë“œì—ì„œ ì§ì ‘ì ìœ¼ë¡œ `window.localStorageì— ì§ì ‘ ì ‘ê·¼`í•˜ëŠ” ê²ƒì´ ë¬¸ì œì˜ ì›ì¸ì´ì—ˆë‹¤.

ì´ëŸ°ì‹ìœ¼ë¡œ ì ‘ê·¼ì„ í•˜ë©´ ì—ëŸ¬ë¥¼ throwí•˜ëŠ”ë° ì—ëŸ¬ë¥¼ ì–´ëŠ ê³³ì—ì„œë„ ì¡ì§€ ì•Šì•„ ì–´í”Œë¦¬ì¼€ì´ì…˜ì´ ê¹¨ì§„ ê²ƒì´ë‹¤.

```js
window.localStorage.setItem('key', value)
// Uncaught DOMException: Failed to read the 'localStorage' property from 'Window'
```

ì´ëŸ° ë¬¸ì œë¥¼ `ì²˜ìŒ` ì ‘í•œ ê°œë°œìëŠ” ë‘ê°€ì§€ ì„ íƒì§€ ì¤‘ í•˜ë‚˜ë¥¼ ì„ íƒí•´ì•¼í•œë‹¤. (ë‚´ê°€ ì´ëŸ° ì„ íƒì§€ë¥¼ ê³ ë¯¼í–ˆë‹¤ëŠ” ëœ»ì€ ì•„ë‹ˆë‹¤..ğŸ˜…)

```
a. ì•„ ê·¸ê±° ì›ë˜ ì•ˆë˜ëŠ” ê±°ì—ìš”~ ëˆ„ê°€ ì¿ í‚¤ ì°¨ë‹¨í•˜ê³  ë¸Œë¼ìš°ì €ë¥¼ ì‚¬ìš©í•˜ë‚˜ìš”?
ê·¸ëŸ° ì—£ì§€ì¼€ì´ìŠ¤ê²½ìš°ì—ëŠ” ëŒ€ì‘ì•ˆí•˜ëŠ” ê²ƒì´ ë§ì•„ìš”~

vs

b. ì¿ í‚¤ì°¨ë‹¨ì„ í•˜ê³  ì‚¬ìš©í•˜ëŠ” ìœ ì €ë¥¼ ìœ„í•´ ë¬¸ì œë¥¼ í•´ê²°í•´ë³¼ê¹Œ?
```

a ì„ íƒì§€ëŠ” ìœ ì €ê°€ ì„œë¹„ìŠ¤ì— ëŒ€í•œ ì‹ ë¢°ë¥¼ ìƒê²Œí•˜ëŠ” ìµœì•…ì˜ ì„ íƒì´ë‹¤.

ê°œë°œìì—ê²Œ ì•ˆë˜ëŠ” ê²ƒì€ ì—†ë‹¤. í•œ ëª…ì˜ ìœ ì €ë¥¼ ìœ„í•´ì„œë¼ë„ ë¬¸ì œë¥¼ í•´ê²°í•´ë³´ì!

## ğŸ¤” ë¬¸ì œ í•´ê²°

ë¬¸ì œì˜ ì›ì¸ì€ window.localStorageì— ì§ì ‘ ì ‘ê·¼í–ˆê³  ê·¸ ì—ëŸ¬ë¥¼ catchí•˜ì§€ ì•Šì•„ì„œ ë°œìƒí–ˆë‹¤.

ê·¸ë ‡ë‹¤ë©´ window.localStorageë¥¼ ì‚¬ìš©í•˜ëŠ” ê¸°ì¡´ì˜ ëª¨ë“  ì½”ë“œì— `try ~ catch`ë¡œ ì—ëŸ¬ì²˜ë¦¬ë¥¼ í•˜ë©´ í•´ê²°ì´ ë ê¹Œ?

```js
// ìˆ˜ì‹­ê°œì˜ íŒŒì¼ì—ì„œ window.localStorage ì°¸ì¡° ì¤‘...
try {
  window.localStorage
} catch (e) {
  // ì—ëŸ¬ ì²˜ë¦¬..
}
```

ì´ëŸ°ì‹ì˜ ì½”ë“œëŠ” ë„ì›€ì´ ë˜ì§€ ì•ŠëŠ”ë‹¤. ê·¼ë³¸ì ì¸ ë¬¸ì œë¥¼ íŒŒì•…í•˜ê³  í•´ê²°í•  ìˆ˜ ìˆì–´ì•¼í•œë‹¤. ê·¼ë³¸ì ì¸ ì›ì¸ì„ ë‹¤ì‹œ ë˜ì§šì–´ë³¸ë‹¤ë©´ `window.localStorageì— ì§ì ‘ ì ‘ê·¼`í–ˆê¸° ë•Œë¬¸ì— ë°œìƒí–ˆë‹¤.

> ê·¸ë ‡ë‹¤ë©´ window.localStorageë¥¼ ì§ì ‘ ì‚¬ìš©í•˜ì§€ ì•ŠëŠ”ë‹¤.

ì–´ë–»ê²Œ ì§ì ‘ ì ‘ê·¼í•˜ì§€ì•Šê³  stoargeë¥¼ ì‚¬ìš©í•  ìˆ˜ ìˆì„ê¹Œ?

window.localStorageëŠ” ë¸Œë¼ìš°ì €, `í™˜ê²½ì— ë”°ë¼ ë‹¬ë¼ì§€ëŠ” ì œì–´í•  ìˆ˜ ì—†ëŠ” ê°’`ì´ë‹¤.

**ìš°ë¦¬ëŠ” ì œì–´í•  ìˆ˜ ì—†ëŠ” window.localStorageë¥¼ ìš°ë¦¬ê°€ ì œì–´í•  ìˆ˜ ìˆëŠ” ì˜ì—­ìœ¼ë¡œ ëŒì–´ë‚´ë ¤ì•¼í•œë‹¤.**

`ì¶”ìƒí™”` ë˜ëŠ” `ë ˆì´ì–´` ë¼ê³  ë¶ˆë¦¬ëŠ” ì•„í‚¤í…ì²˜ë¡œ ìš°ë¦¬ê°€ ì œì–´í•  ìˆ˜ ìˆëŠ” `ì•ˆì „í•œ Storage`ë¥¼ ë§Œë“¤ì–´ë³´ì.

## âœ… SafeStorage

window.localStorageì— ì§ì ‘ ì ‘ê·¼í•˜ëŠ” ê²ƒì´ ì•„ë‹ˆë¼ `safeStorage`ë¼ëŠ” ìš°ë¦¬ê°€ ì§ì ‘ ì •ì˜í•œ ë ˆì´ì–´ë¡œë§Œ ì ‘ê·¼í•  ê²ƒì´ë‹¤.

<img
  src="https://velog.velcdn.com/images/sa02045/post/20b6bdf2-a77c-4393-8b8c-a2b32f0e653e/image.png"
  width="500"
/>

ê¸°ë³¸ì ì¸ ì „ëµì€ ë‹¤ìŒê³¼ ê°™ë‹¤.

1. window.localStorageì— ì§ì ‘ ì ‘ê·¼í•˜ì§€ ì•Šê³  SafeLocalStorageë¥¼ ì‚¬ìš©í•˜ì—¬ ì ‘ê·¼í•œë‹¤.
2. SafeLocalStorageëŠ” ë‹¤ìŒê³¼ ê°™ì€ ê¸°ëŠ¥ì„í•œë‹¤

- 2-1 ë¸Œë¼ìš°ì €ê°€ window.localStorageë¥¼ ì§€ì›í•˜ë©´ window.localStorageë¥¼ ì‚¬ìš©í•œë‹¤.
- 2-1 ì§€ì›í•˜ì§€ ì•ŠëŠ”ë‹¤ë©´ ìë°”ìŠ¤í¬ë¦½íŠ¸ë¡œ ë™ì‘í•˜ëŠ” MemoryStorageë¥¼ ì‚¬ìš©í•œë‹¤.

ê·¸ë ‡ë‹¤ë©´ ì°¨ê·¼ì°¨ê·¼íˆ êµ¬í˜„í•´ë³´ì

### window.localStorage ì ‘ê·¼ ì—¬ë¶€ í™•ì¸

[a brief history of detecting local storage](https://gist.github.com/paulirish/5558557)ì™€ [MDNë¬¸ì„œ](https://developer.mozilla.org/en-US/docs/Web/API/Web_Storage_API/Using_the_Web_Storage_API)ë¥¼ ì½ì–´ë³´ë©´ ë‹¤ìŒ ì½”ë“œë¡œ ì ‘ê·¼ ì—¬ë¶€ë¥¼ í™•ì¸í•  ìˆ˜ ìˆë‹¤. try ~ catchë¡œ í…ŒìŠ¤íŠ¸ ê°’ì„ ì§ì ‘ ë„£ê³  íŒŒì•…í•œë‹¤.

```js
// ë¸Œë¼ìš°ì €ì˜ localStorage ì ‘ê·¼ ì—¬ë¶€
function storageAvailable(type) {
  let storage
  try {
    storage = window[type]
    storage.setItem('TEST_KEY', 'TEST_VALUE')
    storage.removeItem('TEST_KEY')
    return true
  } catch (e) {
    return false
  }
}
```

```js
export const safeLocalStorage = storageAvailable('localStorage')
  ? new LocalStorage()
  : new MemoryStorage()

// Component.vue
// ì‚¬ìš©í•˜ëŠ” ê³³ì—ì„œëŠ” safeLocalStorageë¥¼ ì‚¬ìš©í•œë‹¤.
import { safeLocalStorage } from './utils/Storage'
```

ë²Œì¨ ì½”ë“œì˜ ì ˆë°˜ì„ ì‘ì„±í–ˆë‹¤. ì´ì œ ìš°ë¦¬ê°€ í•´ì•¼í•  ì¼ì€ `ë™ì¼í•œ ì¸í„°í˜ì´ìŠ¤`ë¥¼ ê°€ì§„ LocalStorageì™€ MemoryStorageë¥¼ ì‘ì„±í•˜ëŠ” ê²ƒì´ë‹¤.

`ìš°ë¦¬ì—ê²Œ ì´ë¯¸ ìµìˆ™í•œ í‘œì¤€ ì¸í„°í˜ì´ìŠ¤`ë¥¼ ëª¨í‹°ë¸Œ ì‚¼ì•„ ì‘ì„±í•´ë³´ì.

> í‘œì¤€ ì¸í„°í˜ì´ìŠ¤ì— ê°€ê¹Œìš¸ìˆ˜ë¡ ì‚¬ìš©í•˜ê¸° í¸í•œë‹¤.

```js
// í‘œì¤€ ì¸í„°í˜ì´ìŠ¤
window.localStorage.getItem('key')
window.localStorage.setItem('key', value)
window.localStorage.clear()

// ìš°ë¦¬ê°€ ë§Œë“¤ Storageì˜ ì¸í„°í˜ì´ìŠ¤
memoryStorage.getItem('key')
memoryStorage.setItem('key', value)
memoryStorage.removeItem('key')
memoryStorage.clear()
```

```js
// typescript ì¸í„°í˜ì´ìŠ¤

export interface SafeStorage {
  storage: Storage | Map<string, string>;
  getItem(key: string): string | null;
  setItem(key: string, value: string): void;
  removeItem(key: string): void;
  clear: () => void;
}
```

### MemoryStorage êµ¬í˜„í•˜ê¸°

ë¸Œë¼ìš°ì €ì—ì„œ ì œê³µí•˜ëŠ” web APIê°€ ì•„ë‹Œ `ìë°”ìŠ¤í¬ë¦½íŠ¸ë¡œ ë™ì‘í•˜ëŠ” MemoryStorage`ë¥¼ ë§Œë“¤ì–´ë³´ì.

> ìë°”ìŠ¤í¬ë¦½íŠ¸ë¡œ ë™ì‘í•˜ê¸° ë•Œë¬¸ì— ë¸Œë¼ìš°ì € ê°™ì€ ì™¸ë¶€ ìš”ì¸ì— ì˜í–¥ì„ ë°›ì§€ ì•ŠëŠ”ë‹¤.

ì—„ì—°íˆ ì–˜ê¸°í•˜ë©´ ì–´í”Œë¦¬ì¼€ì´ì…˜ì´ ë™ì‘í•˜ëŠ” ë™ì•ˆì—ë§Œ `ë°ì´í„°ë¥¼ ì ì‹œë§Œ ì €ì¥`í•˜ê¸° ë•Œë¬¸ì— ë¸Œë¼ìš°ì €ë¥¼ ë‹«ê±°ë‚˜, ìƒˆë¡œê³ ì¹¨ì„ í•œë‹¤ê±°ë‚˜ í•˜ë©´ ë‚ ë¼ê°€ëŠ” íœ˜ë°œì„± ë°ì´í„°ì´ë‹¤.

ë‹¹ì—°í•˜ê²Œë„ storageê°€ ì°¨ë‹¨ë˜ì–´ìˆìœ¼ë©´ ë¸Œë¼ìš°ì €ì— ë°ì´í„°ë¥¼ ì €ì¥í•  ë°©ë²•ì´ ì—†ìœ¼ë¯€ë¡œ ì„ì‹œë°©í¸ìœ¼ë¡œ ëŒ€ì‹  ì œê³µí•˜ëŠ” ì…ˆì´ë‹¤.

ë‹¨ìˆœ ê°ì²´ë¡œ êµ¬í˜„í•´ë„ ë˜ì§€ë§Œ, ES6ë¶€í„° ì§€ì›ë˜ëŠ” ìƒˆë¡œìš´ ìë£Œêµ¬ì¡° `Map ê°ì²´`ë¥¼ ì‚¬ìš©í•´ë³´ì.

```js

class MemoryStorage implements SafeStorage {
  storage: Map<string, string>;

  constructor() {
    this.storage = new Map<string, string>();
  }

  getItem(key: string): string | null {
    return this.storage.get(key) || null;
  }

  setItem(key: string, value: string): void {
    this.storage.set(key, value);
  }

  removeItem(key: string): void {
    this.storage.delete(key);
  }

  clear() {
    this.storage.clear();
  }
}

const memoryStorage = new MemoryStorage()
memoryStorage.getItem('key')
memoryStorage.setItme('key', value)
```

Map ê°ì²´ì˜ `get` `set` `delete` ë©”ì„œë“œë¥¼ ì‚¬ìš©í•˜ë©´ ë¹„ìŠ·í•œ ì¸í„°í˜ì´ìŠ¤ë¥¼ êµ¬í˜„í•  ìˆ˜ ìˆë‹¤.

### LocalStorage

ë§ˆì°¬ê°€ì§€ë¡œ ìš°ë¦¬ì˜ ì¸í„°í˜ì´ìŠ¤ë¥¼ ê°€ì§€ëŠ” LocalStorageë¥¼ êµ¬í˜„í•´ë³´ì. ì¸í„°í˜ì´ìŠ¤ëŠ” ë™ì¼í•˜ê¸° ë–„ë¬¸ì— ìƒì„±ìì˜ storageë¥¼ ì œì™¸í•œ ëª¨ë“  ë©”ì„œë“œëŠ” Memory Storageì™€ ë™ì¼í•˜ë‹¤

```js
class LocalStorage implements SafeStorage {
  storage: Storage;

  constructor() {
    this.storage = window.localStorage;
  }

  getItem(key: string): string | null {
    return this.storage.getItem(key) || null;
  }

  setItem(key: string, value: string): void {
    this.storage.setItem(key, value);
  }

  removeItem(key: string): void {
    this.storage.removeItem(key);
  }

  clear() {
    this.storage.clear();
  }
}
```

ì•¼í˜¸! ì´ì œ ìš°ë¦¬ëŠ” ì–´ë– í•œ ìƒí™©ì—ë„ ì•ˆì „í•˜ê²Œ Storageë¥¼ ì‚¬ìš©í•  ìˆ˜ ìˆë‹¤.

```js
export const safeLocalStorage = storageAvailable('localStorage')
  ? new LocalStorage()
  : new MemoryStorage()
```

## ğŸŸ¢ ì •ë¦¬

1. ì œì–´í• ìˆ˜ ì—†ëŠ” ìš”ì†ŒëŠ” ì œì–´í•  ìˆ˜ ìˆëŠ” ì˜ì—­ìœ¼ë¡œ ëŒì–´ë‚´ë ¤ì•¼í•œë‹¤.
2. `ê³„ì¸µ`ì„ ë‘ë©´ `ê°•ê²°í•©`ë˜ì–´ ìˆëŠ” ìš”ì†Œë¥¼ ë¶„ë¦¬í•˜ê³  `ëŠìŠ¨`í•˜ê²Œ ì—°ê²° í•  ìˆ˜ ìˆë‹¤.

### ì°¸ê³ 

1. https://github.com/toss/slash/blob/main/packages/common/storage/src/storage.ts
2. https://gist.github.com/paulirish/5558557
